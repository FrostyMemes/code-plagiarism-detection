<!DOCTYPE html>
            <html>
            <head>
            <meta charset="utf-8"/>
            <title>Похожие решения</title>
            <style type="text/css">
            * {padding-top:0;margin-top:0;border-top:0;}
            .Common {background-color: #ff9999;}
            tr, td {vertical-align: top; border-left: 1px solid #ddd;border-bottom: 1px solid #ddd;}
            th {background-color: #ddd} 
            </style>
            </head>
            <body>
            <pre>
            <table valign="top">
<tr>
	<th>1.c</th><th>2.c</th>
</tr><tr>
	<td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Drawing</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
    </span><span class="Common">public</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">GameState</span><span class="Common">
    </span><span class="Common">{</span><span class="Common">
        </span><span class="Common">public</span><span class="Common"> </span><span class="Common">const</span><span class="Common"> </span><span class="Common">int</span><span class="Common"> </span><span class="Common">ElementSize</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">32</span><span class="Common">;</span><span class="Common">
        </span><span class="Common">public</span><span class="Common"> </span><span class="Common">List</span><span class="Common">&lt;</span><span class="Common">CreatureAnimation</span><span class="Common">&gt;</span><span class="Common"> </span><span class="Common">Animations</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">List</span><span class="Common">&lt;</span><span class="Common">CreatureAnimation</span><span class="Common">&gt;</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Original">

        </span><span class="Original">private</span><span class="Original"> </span><span class="Original">static</span><span class="Original"> </span><span class="Original">ICreature</span><span class="Original"> </span><span class="Original">SelectWinnerCandidatePerLocation</span><span class="Original">(</span><span class="Original">List</span><span class="Original">&lt;</span><span class="Original">ICreature</span><span class="Original">&gt;</span><span class="Original">[</span><span class="Original">,</span><span class="Original">]</span><span class="Original"> </span><span class="Original">creatures</span><span class="Original">,</span><span class="Original"> </span><span class="Original">int</span><span class="Original"> </span><span class="Original">x</span><span class="Original">,</span><span class="Original"> </span><span class="Original">int</span><span class="Original"> </span><span class="Original">y</span><span class="Original">)</span><span class="Original">
        </span><span class="Original">{</span><span class="Original">
            </span><span class="Original">var</span><span class="Original"> </span><span class="Original">candidates</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">creatures</span><span class="Original">[</span><span class="Original">x</span><span class="Original">,</span><span class="Original"> </span><span class="Original">y</span><span class="Original">]</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">var</span><span class="Original"> </span><span class="Original">aliveCandidates</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">candidates</span><span class="Original">.</span><span class="Original">ToList</span><span class="Original">(</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">foreach</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">candidate</span><span class="Original"> </span><span class="Original">in</span><span class="Original"> </span><span class="Original">candidates</span><span class="Original">)</span><span class="Original">
            </span><span class="Original">foreach</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">rival</span><span class="Original"> </span><span class="Original">in</span><span class="Original"> </span><span class="Original">candidates</span><span class="Original">)</span><span class="Original">
                </span><span class="Original">if</span><span class="Original"> </span><span class="Original">(</span><span class="Original">rival</span><span class="Original"> </span><span class="Original">!</span><span class="Original">=</span><span class="Original"> </span><span class="Original">candidate</span><span class="Original"> </span><span class="Original">&amp;</span><span class="Original">&amp;</span><span class="Original"> </span><span class="Original">candidate</span><span class="Original">.</span><span class="Original">DeadInConflict</span><span class="Original">(</span><span class="Original">rival</span><span class="Original">)</span><span class="Original">)</span><span class="Original">
                    </span><span class="Original">aliveCandidates</span><span class="Original">.</span><span class="Original">Remove</span><span class="Original">(</span><span class="Original">candidate</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">if</span><span class="Original"> </span><span class="Original">(</span><span class="Original">aliveCandidates</span><span class="Original">.</span><span class="Original">Count</span><span class="Original"> </span><span class="Original">&gt;</span><span class="Original"> </span><span class="Original">1</span><span class="Original">)</span><span class="Original">
                </span><span class="Original">throw</span><span class="Original"> </span><span class="Original">new</span><span class="Original"> </span><span class="Original">Exception</span><span class="Original">(</span><span class="Original">
                    </span><span class="Original">$</span><span class="Original">&quot;</span><span class="Original">Creatures</span><span class="Original"> </span><span class="Original">{</span><span class="Original">aliveCandidates</span><span class="Original">[</span><span class="Original">0</span><span class="Original">]</span><span class="Original">.</span><span class="Original">GetType</span><span class="Original">(</span><span class="Original">)</span><span class="Original">.</span><span class="Original">Name</span><span class="Original">}</span><span class="Original"> </span><span class="Original">and</span><span class="Original"> </span><span class="Original">{</span><span class="Original">aliveCandidates</span><span class="Original">[</span><span class="Original">1</span><span class="Original">]</span><span class="Original">.</span><span class="Original">GetType</span><span class="Original">(</span><span class="Original">)</span><span class="Original">.</span><span class="Original">Name</span><span class="Original">}</span><span class="Original"> </span><span class="Original">claimed</span><span class="Original"> </span><span class="Original">the</span><span class="Original"> </span><span class="Original">same</span><span class="Original"> </span><span class="Original">map</span><span class="Original"> </span><span class="Original">cell</span><span class="Original">&quot;</span><span class="Original">)</span><span class="Original">;</span><span class="Original">

            </span><span class="Original">return</span><span class="Original"> </span><span class="Original">aliveCandidates</span><span class="Original">.</span><span class="Original">FirstOrDefault</span><span class="Original">(</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
        </span><span class="Original">}</span><span class="Original">

        </span><span class="Original">private</span><span class="Original"> </span><span class="Original">List</span><span class="Original">&lt;</span><span class="Original">ICreature</span><span class="Original">&gt;</span><span class="Original">[</span><span class="Original">,</span><span class="Original">]</span><span class="Original"> </span><span class="Original">GetCandidatesPerLocation</span><span class="Original">(</span><span class="Original">)</span><span class="Original">
        </span><span class="Original">{</span><span class="Original">
            </span><span class="Original">var</span><span class="Original"> </span><span class="Original">creatures</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">new</span><span class="Original"> </span><span class="Original">List</span><span class="Original">&lt;</span><span class="Original">ICreature</span><span class="Original">&gt;</span><span class="Original">[</span><span class="Original">Game</span><span class="Original">.</span><span class="Original">MapWidth</span><span class="Original">,</span><span class="Original"> </span><span class="Original">Game</span><span class="Original">.</span><span class="Original">MapHeight</span><span class="Original">]</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">for</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">x</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">0</span><span class="Original">;</span><span class="Original"> </span><span class="Original">x</span><span class="Original"> </span><span class="Original">&lt;</span><span class="Original"> </span><span class="Original">Game</span><span class="Original">.</span><span class="Original">MapWidth</span><span class="Original">;</span><span class="Original"> </span><span class="Original">x</span><span class="Original">+</span><span class="Original">+</span><span class="Original">)</span><span class="Original">
            </span><span class="Original">for</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">y</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">0</span><span class="Original">;</span><span class="Original"> </span><span class="Original">y</span><span class="Original"> </span><span class="Original">&lt;</span><span class="Original"> </span><span class="Original">Game</span><span class="Original">.</span><span class="Original">MapHeight</span><span class="Original">;</span><span class="Original"> </span><span class="Original">y</span><span class="Original">+</span><span class="Original">+</span><span class="Original">)</span><span class="Original">
                </span><span class="Original">creatures</span><span class="Original">[</span><span class="Original">x</span><span class="Original">,</span><span class="Original"> </span><span class="Original">y</span><span class="Original">]</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">new</span><span class="Original"> </span><span class="Original">List</span><span class="Original">&lt;</span><span class="Original">ICreature</span><span class="Original">&gt;</span><span class="Original">(</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">foreach</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">e</span><span class="Original"> </span><span class="Original">in</span><span class="Original"> </span><span class="Original">Animations</span><span class="Original">)</span><span class="Original">
            </span><span class="Original">{</span><span class="Original">
                </span><span class="Original">var</span><span class="Original"> </span><span class="Original">x</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">e</span><span class="Original">.</span><span class="Original">TargetLogicalLocation</span><span class="Original">.</span><span class="Original">X</span><span class="Original">;</span><span class="Original">
                </span><span class="Original">var</span><span class="Original"> </span><span class="Original">y</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">e</span><span class="Original">.</span><span class="Original">TargetLogicalLocation</span><span class="Original">.</span><span class="Original">Y</span><span class="Original">;</span><span class="Original">
                </span><span class="Original">var</span><span class="Original"> </span><span class="Original">nextCreature</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">e</span><span class="Original">.</span><span class="Original">Command</span><span class="Original">.</span><span class="Original">TransformTo</span><span class="Original"> </span><span class="Original">?</span><span class="Original">?</span><span class="Original"> </span><span class="Original">e</span><span class="Original">.</span><span class="Original">Creature</span><span class="Original">;</span><span class="Original">
                </span><span class="Original">creatures</span><span class="Original">[</span><span class="Original">x</span><span class="Original">,</span><span class="Original"> </span><span class="Original">y</span><span class="Original">]</span><span class="Original">.</span><span class="Original">Add</span><span class="Original">(</span><span class="Original">nextCreature</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">}</span><span class="Original">

            </span><span class="Original">return</span><span class="Original"> </span><span class="Original">creatures</span><span class="Original">;</span><span class="Original">
        </span><span class="Original">}</span><span class="Original">
        
        </span><span class="Common">public</span><span class="Common"> </span><span class="Common">void</span><span class="Common"> </span><span class="Common">BeginAct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
        </span><span class="Common">{</span><span class="Common">
            </span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">Clear</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
            </span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
            </span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
            </span><span class="Common">{</span><span class="Common">
                </span><span class="Common">var</span><span class="Common"> </span><span class="Common">creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">Map</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
                </span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Common"> </span><span class="Common">continue</span><span class="Common">;</span><span class="Common">
                </span><span class="Common">var</span><span class="Common"> </span><span class="Common">command</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creature</span><span class="Common">.</span><span class="Common">Act</span><span class="Common">(</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

                </span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">x</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">0</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common"> </span><span class="Common">&gt;</span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">0</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Common">
                    </span><span class="Common">y</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common"> </span><span class="Common">&gt;</span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">)</span><span class="Common">
                    </span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">&quot;</span><span class="Common">The</span><span class="Common"> </span><span class="Common">object</span><span class="Common"> </span><span class="Common">{</span><span class="Common">creature</span><span class="Common">.</span><span class="Common">GetType</span><span class="Common">(</span><span class="Common">)</span><span class="Common">}</span><span class="Common"> </span><span class="Common">falls</span><span class="Common"> </span><span class="Common">out</span><span class="Common"> </span><span class="Common">of</span><span class="Common"> </span><span class="Common">the</span><span class="Common"> </span><span class="Common">game</span><span class="Common"> </span><span class="Common">field</span><span class="Common">&quot;</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

                </span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">Add</span><span class="Common">(</span><span class="Common">
                    </span><span class="Common">new</span><span class="Common"> </span><span class="Common">CreatureAnimation</span><span class="Common">
                    </span><span class="Common">{</span><span class="Common">
                        </span><span class="Common">Command</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">command</span><span class="Common">,</span><span class="Common">
                        </span><span class="Common">Creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creature</span><span class="Common">,</span><span class="Common">
                        </span><span class="Common">Location</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Point</span><span class="Common">(</span><span class="Common">x</span><span class="Common"> </span><span class="Common">*</span><span class="Common"> </span><span class="Common">ElementSize</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">*</span><span class="Common"> </span><span class="Common">ElementSize</span><span class="Common">)</span><span class="Common">,</span><span class="Common">
                        </span><span class="Common">TargetLogicalLocation</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Point</span><span class="Common">(</span><span class="Common">x</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common">)</span><span class="Common">
                    </span><span class="Common">}</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
            </span><span class="Common">}</span><span class="Common">

            </span><span class="Common">Animations</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">OrderByDescending</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">&gt;</span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Creature</span><span class="Common">.</span><span class="Common">GetDrawingPriority</span><span class="Common">(</span><span class="Common">)</span><span class="Common">)</span><span class="Common">.</span><span class="Common">ToList</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
        </span><span class="Common">}</span><span class="Common">

        </span><span class="Common">public</span><span class="Common"> </span><span class="Common">void</span><span class="Common"> </span><span class="Common">EndAct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
        </span><span class="Common">{</span><span class="Common">
            </span><span class="Common">var</span><span class="Common"> </span><span class="Common">creaturesPerLocation</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">GetCandidatesPerLocation</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
            </span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
            </span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
                </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">Map</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">SelectWinnerCandidatePerLocation</span><span class="Common">(</span><span class="Common">creaturesPerLocation</span><span class="Common">,</span><span class="Common"> </span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
        </span><span class="Common">}</span><span class="Common">

    </span><span class="Common">}</span><span class="Common">
</span><span class="Common">}</span></td><td><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Collections</span><span class="Common">.</span><span class="Common">Generic</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Drawing</span><span class="Common">;</span><span class="Common">
</span><span class="Common">using</span><span class="Common"> </span><span class="Common">System</span><span class="Common">.</span><span class="Common">Linq</span><span class="Common">;</span><span class="Common">

</span><span class="Common">namespace</span><span class="Common"> </span><span class="Common">Digger</span><span class="Common">
</span><span class="Common">{</span><span class="Common">
    </span><span class="Common">public</span><span class="Common"> </span><span class="Common">class</span><span class="Common"> </span><span class="Common">GameState</span><span class="Common">
    </span><span class="Common">{</span><span class="Common">
        </span><span class="Common">public</span><span class="Common"> </span><span class="Common">const</span><span class="Common"> </span><span class="Common">int</span><span class="Common"> </span><span class="Common">ElementSize</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">32</span><span class="Common">;</span><span class="Common">
        </span><span class="Common">public</span><span class="Common"> </span><span class="Common">List</span><span class="Common">&lt;</span><span class="Common">CreatureAnimation</span><span class="Common">&gt;</span><span class="Common"> </span><span class="Common">Animations</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">List</span><span class="Common">&lt;</span><span class="Common">CreatureAnimation</span><span class="Common">&gt;</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

        </span><span class="Common">public</span><span class="Common"> </span><span class="Common">void</span><span class="Common"> </span><span class="Common">BeginAct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
        </span><span class="Common">{</span><span class="Common">
            </span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">Clear</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
            </span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
            </span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
            </span><span class="Common">{</span><span class="Common">
                </span><span class="Common">var</span><span class="Common"> </span><span class="Common">creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">Map</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common">;</span><span class="Common">
                </span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common">=</span><span class="Common"> </span><span class="Common">null</span><span class="Common">)</span><span class="Common"> </span><span class="Common">continue</span><span class="Common">;</span><span class="Common">
                </span><span class="Common">var</span><span class="Common"> </span><span class="Common">command</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creature</span><span class="Common">.</span><span class="Common">Act</span><span class="Common">(</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

                </span><span class="Common">if</span><span class="Common"> </span><span class="Common">(</span><span class="Common">x</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">0</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common"> </span><span class="Common">&gt;</span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">0</span><span class="Common"> </span><span class="Common">|</span><span class="Common">|</span><span class="Common">
                    </span><span class="Common">y</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common"> </span><span class="Common">&gt;</span><span class="Common">=</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">)</span><span class="Common">
                    </span><span class="Common">throw</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Exception</span><span class="Common">(</span><span class="Common">$</span><span class="Common">&quot;</span><span class="Common">The</span><span class="Common"> </span><span class="Common">object</span><span class="Common"> </span><span class="Common">{</span><span class="Common">creature</span><span class="Common">.</span><span class="Common">GetType</span><span class="Common">(</span><span class="Common">)</span><span class="Common">}</span><span class="Common"> </span><span class="Common">falls</span><span class="Common"> </span><span class="Common">out</span><span class="Common"> </span><span class="Common">of</span><span class="Common"> </span><span class="Common">the</span><span class="Common"> </span><span class="Common">game</span><span class="Common"> </span><span class="Common">field</span><span class="Common">&quot;</span><span class="Common">)</span><span class="Common">;</span><span class="Common">

                </span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">Add</span><span class="Common">(</span><span class="Common">
                    </span><span class="Common">new</span><span class="Common"> </span><span class="Common">CreatureAnimation</span><span class="Common">
                    </span><span class="Common">{</span><span class="Common">
                        </span><span class="Common">Command</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">command</span><span class="Common">,</span><span class="Common">
                        </span><span class="Common">Creature</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">creature</span><span class="Common">,</span><span class="Common">
                        </span><span class="Common">Location</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Point</span><span class="Common">(</span><span class="Common">x</span><span class="Common"> </span><span class="Common">*</span><span class="Common"> </span><span class="Common">ElementSize</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">*</span><span class="Common"> </span><span class="Common">ElementSize</span><span class="Common">)</span><span class="Common">,</span><span class="Common">
                        </span><span class="Common">TargetLogicalLocation</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">new</span><span class="Common"> </span><span class="Common">Point</span><span class="Common">(</span><span class="Common">x</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaX</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">+</span><span class="Common"> </span><span class="Common">command</span><span class="Common">.</span><span class="Common">DeltaY</span><span class="Common">)</span><span class="Common">
                    </span><span class="Common">}</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
            </span><span class="Common">}</span><span class="Common">

            </span><span class="Common">Animations</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">Animations</span><span class="Common">.</span><span class="Common">OrderByDescending</span><span class="Common">(</span><span class="Common">z</span><span class="Common"> </span><span class="Common">=</span><span class="Common">&gt;</span><span class="Common"> </span><span class="Common">z</span><span class="Common">.</span><span class="Common">Creature</span><span class="Common">.</span><span class="Common">GetDrawingPriority</span><span class="Common">(</span><span class="Common">)</span><span class="Common">)</span><span class="Common">.</span><span class="Common">ToList</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
        </span><span class="Common">}</span><span class="Common">

        </span><span class="Common">public</span><span class="Common"> </span><span class="Common">void</span><span class="Common"> </span><span class="Common">EndAct</span><span class="Common">(</span><span class="Common">)</span><span class="Common">
        </span><span class="Common">{</span><span class="Common">
            </span><span class="Common">var</span><span class="Common"> </span><span class="Common">creaturesPerLocation</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">GetCandidatesPerLocation</span><span class="Common">(</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
            </span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapWidth</span><span class="Common">;</span><span class="Common"> </span><span class="Common">x</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
            </span><span class="Common">for</span><span class="Common"> </span><span class="Common">(</span><span class="Common">var</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">0</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common"> </span><span class="Common">&lt;</span><span class="Common"> </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">MapHeight</span><span class="Common">;</span><span class="Common"> </span><span class="Common">y</span><span class="Common">+</span><span class="Common">+</span><span class="Common">)</span><span class="Common">
                </span><span class="Common">Game</span><span class="Common">.</span><span class="Common">Map</span><span class="Common">[</span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">]</span><span class="Common"> </span><span class="Common">=</span><span class="Common"> </span><span class="Common">SelectWinnerCandidatePerLocation</span><span class="Common">(</span><span class="Common">creaturesPerLocation</span><span class="Common">,</span><span class="Common"> </span><span class="Common">x</span><span class="Common">,</span><span class="Common"> </span><span class="Common">y</span><span class="Common">)</span><span class="Common">;</span><span class="Common">
        </span><span class="Common">}</span><span class="Original">

        </span><span class="Original">private</span><span class="Original"> </span><span class="Original">static</span><span class="Original"> </span><span class="Original">ICreature</span><span class="Original"> </span><span class="Original">SelectWinnerCandidatePerLocation</span><span class="Original">(</span><span class="Original">List</span><span class="Original">&lt;</span><span class="Original">ICreature</span><span class="Original">&gt;</span><span class="Original">[</span><span class="Original">,</span><span class="Original">]</span><span class="Original"> </span><span class="Original">creatures</span><span class="Original">,</span><span class="Original"> </span><span class="Original">int</span><span class="Original"> </span><span class="Original">x</span><span class="Original">,</span><span class="Original"> </span><span class="Original">int</span><span class="Original"> </span><span class="Original">y</span><span class="Original">)</span><span class="Original">
        </span><span class="Original">{</span><span class="Original">
            </span><span class="Original">var</span><span class="Original"> </span><span class="Original">candidates</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">creatures</span><span class="Original">[</span><span class="Original">x</span><span class="Original">,</span><span class="Original"> </span><span class="Original">y</span><span class="Original">]</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">var</span><span class="Original"> </span><span class="Original">aliveCandidates</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">candidates</span><span class="Original">.</span><span class="Original">ToList</span><span class="Original">(</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">foreach</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">candidate</span><span class="Original"> </span><span class="Original">in</span><span class="Original"> </span><span class="Original">candidates</span><span class="Original">)</span><span class="Original">
            </span><span class="Original">foreach</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">rival</span><span class="Original"> </span><span class="Original">in</span><span class="Original"> </span><span class="Original">candidates</span><span class="Original">)</span><span class="Original">
                </span><span class="Original">if</span><span class="Original"> </span><span class="Original">(</span><span class="Original">rival</span><span class="Original"> </span><span class="Original">!</span><span class="Original">=</span><span class="Original"> </span><span class="Original">candidate</span><span class="Original"> </span><span class="Original">&amp;</span><span class="Original">&amp;</span><span class="Original"> </span><span class="Original">candidate</span><span class="Original">.</span><span class="Original">DeadInConflict</span><span class="Original">(</span><span class="Original">rival</span><span class="Original">)</span><span class="Original">)</span><span class="Original">
                    </span><span class="Original">aliveCandidates</span><span class="Original">.</span><span class="Original">Remove</span><span class="Original">(</span><span class="Original">candidate</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">if</span><span class="Original"> </span><span class="Original">(</span><span class="Original">aliveCandidates</span><span class="Original">.</span><span class="Original">Count</span><span class="Original"> </span><span class="Original">&gt;</span><span class="Original"> </span><span class="Original">1</span><span class="Original">)</span><span class="Original">
                </span><span class="Original">throw</span><span class="Original"> </span><span class="Original">new</span><span class="Original"> </span><span class="Original">Exception</span><span class="Original">(</span><span class="Original">
                    </span><span class="Original">$</span><span class="Original">&quot;</span><span class="Original">Creatures</span><span class="Original"> </span><span class="Original">{</span><span class="Original">aliveCandidates</span><span class="Original">[</span><span class="Original">0</span><span class="Original">]</span><span class="Original">.</span><span class="Original">GetType</span><span class="Original">(</span><span class="Original">)</span><span class="Original">.</span><span class="Original">Name</span><span class="Common">}</span><span class="Original"> </span><span class="Original">and</span><span class="Original"> </span><span class="Original">{</span><span class="Original">aliveCandidates</span><span class="Original">[</span><span class="Original">1</span><span class="Original">]</span><span class="Original">.</span><span class="Original">GetType</span><span class="Original">(</span><span class="Original">)</span><span class="Original">.</span><span class="Original">Name</span><span class="Common">}</span><span class="Original"> </span><span class="Original">claimed</span><span class="Original"> </span><span class="Original">the</span><span class="Original"> </span><span class="Original">same</span><span class="Original"> </span><span class="Original">map</span><span class="Original"> </span><span class="Original">cell</span><span class="Original">&quot;</span><span class="Original">)</span><span class="Original">;</span><span class="Original">

            </span><span class="Original">return</span><span class="Original"> </span><span class="Original">aliveCandidates</span><span class="Original">.</span><span class="Original">FirstOrDefault</span><span class="Original">(</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
        </span><span class="Original">}</span><span class="Original">

        </span><span class="Original">private</span><span class="Original"> </span><span class="Original">List</span><span class="Original">&lt;</span><span class="Original">ICreature</span><span class="Original">&gt;</span><span class="Original">[</span><span class="Original">,</span><span class="Original">]</span><span class="Original"> </span><span class="Original">GetCandidatesPerLocation</span><span class="Original">(</span><span class="Original">)</span><span class="Original">
        </span><span class="Original">{</span><span class="Original">
            </span><span class="Original">var</span><span class="Original"> </span><span class="Original">creatures</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">new</span><span class="Original"> </span><span class="Original">List</span><span class="Original">&lt;</span><span class="Original">ICreature</span><span class="Original">&gt;</span><span class="Original">[</span><span class="Original">Game</span><span class="Original">.</span><span class="Original">MapWidth</span><span class="Original">,</span><span class="Original"> </span><span class="Original">Game</span><span class="Original">.</span><span class="Original">MapHeight</span><span class="Original">]</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">for</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">x</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">0</span><span class="Original">;</span><span class="Original"> </span><span class="Original">x</span><span class="Original"> </span><span class="Original">&lt;</span><span class="Original"> </span><span class="Original">Game</span><span class="Original">.</span><span class="Original">MapWidth</span><span class="Original">;</span><span class="Original"> </span><span class="Original">x</span><span class="Original">+</span><span class="Original">+</span><span class="Original">)</span><span class="Original">
            </span><span class="Original">for</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">y</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">0</span><span class="Original">;</span><span class="Original"> </span><span class="Original">y</span><span class="Original"> </span><span class="Original">&lt;</span><span class="Original"> </span><span class="Original">Game</span><span class="Original">.</span><span class="Original">MapHeight</span><span class="Original">;</span><span class="Original"> </span><span class="Original">y</span><span class="Original">+</span><span class="Original">+</span><span class="Original">)</span><span class="Original">
                </span><span class="Original">creatures</span><span class="Original">[</span><span class="Original">x</span><span class="Original">,</span><span class="Original"> </span><span class="Original">y</span><span class="Original">]</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">new</span><span class="Original"> </span><span class="Original">List</span><span class="Original">&lt;</span><span class="Original">ICreature</span><span class="Original">&gt;</span><span class="Original">(</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">foreach</span><span class="Original"> </span><span class="Original">(</span><span class="Original">var</span><span class="Original"> </span><span class="Original">e</span><span class="Original"> </span><span class="Original">in</span><span class="Original"> </span><span class="Original">Animations</span><span class="Original">)</span><span class="Original">
            </span><span class="Original">{</span><span class="Original">
                </span><span class="Original">var</span><span class="Original"> </span><span class="Original">x</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">e</span><span class="Original">.</span><span class="Original">TargetLogicalLocation</span><span class="Original">.</span><span class="Original">X</span><span class="Original">;</span><span class="Original">
                </span><span class="Original">var</span><span class="Original"> </span><span class="Original">y</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">e</span><span class="Original">.</span><span class="Original">TargetLogicalLocation</span><span class="Original">.</span><span class="Original">Y</span><span class="Original">;</span><span class="Original">
                </span><span class="Original">var</span><span class="Original"> </span><span class="Original">nextCreature</span><span class="Original"> </span><span class="Original">=</span><span class="Original"> </span><span class="Original">e</span><span class="Original">.</span><span class="Original">Command</span><span class="Original">.</span><span class="Original">TransformTo</span><span class="Original"> </span><span class="Original">?</span><span class="Original">?</span><span class="Original"> </span><span class="Original">e</span><span class="Original">.</span><span class="Original">Creature</span><span class="Original">;</span><span class="Original">
                </span><span class="Original">creatures</span><span class="Original">[</span><span class="Original">x</span><span class="Original">,</span><span class="Original"> </span><span class="Original">y</span><span class="Original">]</span><span class="Original">.</span><span class="Original">Add</span><span class="Original">(</span><span class="Original">nextCreature</span><span class="Original">)</span><span class="Original">;</span><span class="Original">
            </span><span class="Original">}</span><span class="Original">

            </span><span class="Original">return</span><span class="Original"> </span><span class="Original">creatures</span><span class="Original">;</span><span class="Original">
        </span><span class="Original">}</span><span class="Original">
    </span><span class="Original">}</span><span class="Original">
</span><span class="Original">}</span></td>
</tr></table></pre></body></html>
